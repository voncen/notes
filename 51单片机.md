- [c51](#c51)
  - [头文件](#头文件)
  - [特殊功能位](#特殊功能位)
  - [端口表示](#端口表示)
  - [局部变量](#局部变量)
- [电平特性](#电平特性)
- [开发流程](#开发流程)
- [项目开发相关知识](#项目开发相关知识)
- [MCS-51单片机基本特性](#mcs-51单片机基本特性)
  - [总线](#总线)
  - [基本结构](#基本结构)
  - [晶振](#晶振)
  - [单片机的引脚](#单片机的引脚)
    - [电源端：Vcc，GND](#电源端vccgnd)
    - [晶振端：](#晶振端)
    - [复位端：](#复位端)
    - [EA端：](#ea端)
    - [PSEN端](#psen端)
    - [P1口](#p1口)
    - [IO口](#io口)
- [案例](#案例)
  - [点亮一个LED灯](#点亮一个led灯)
    - [原理](#原理)
    - [部件](#部件)
      - [晶振](#晶振-1)
      - [电源](#电源)
      - [字节](#字节)
  - [流水灯项目](#流水灯项目)
    - [原理](#原理-1)
    - [延时函数](#延时函数)
    - [初始化](#初始化)
    - [改变流水灯速度](#改变流水灯速度)
    - [左移和右移](#左移和右移)
  - [蜂鸣器使用](#蜂鸣器使用)
    - [设计方法](#设计方法)
  - [8.数码管静态显示](#8数码管静态显示)
    - [常用显示器](#常用显示器)
    - [数码管的结构](#数码管的结构)
    - [数码管显示原理](#数码管显示原理)
    - [静态显示驱动：直流驱动](#静态显示驱动直流驱动)
    - [动态显示驱动](#动态显示驱动)
    - [显示效果](#显示效果)
    - [芯片74HC573](#芯片74hc573)
  - [9.数码管动态显示](#9数码管动态显示)
  - [10.独立键盘输入](#10独立键盘输入)
    - [P3口](#p3口)
    - [BST-V51独立按键](#bst-v51独立按键)
    - [键盘软件消抖](#键盘软件消抖)
  - [11.矩阵键盘扫描](#11矩阵键盘扫描)

### c51

sfr:特殊功能寄存器声明
sfr 变量名=地址值；
*特殊功能寄存器在reg51.H这个头文件里面都帮我们定义好了，所以平时我们就不要自己去定义寄存器的名字。
sbit:特殊功能位声明
sbit 变量名=地址值；
*在给某个引脚取名的时候经常会用到。
bit:位变量声明
*用来定义位数据变量
例：sfr SCON = 0X98;
sbit LED = P0^2;

```c
#define a name 	
这是一个预处理命令，在程序编译的时候，程序中出现的a用name。
这条语句相当于给name另外取一个名字叫做a。

```
#### 头文件
- REG51.H、REG52.H、STC.H
- STC.H适用于所有STC出的 51单片机(包括1T和传统单片机)
-  相应头文件内包含：REG51.H
-  头文件包含特殊寄存器SFR定义，包含特殊功能位定义等
-  还可以自己写自己用的专用头文件，定义你需要定义的IO输出输入口，更能方便自己写程序。
#### 特殊功能位

- 也可以说是特殊功能位声明。
- Sbit：一般用来定义一个特殊功能寄存器(SFR)的可寻址的某一位 。利用它，可以访问8051单片机
- 特殊功能寄存器（ SFR ）中的可寻址位。
- 一般格式：
  + Sbit 位变量名＝特殊功能寄存器名^位位置
  + Sbit LED1=P0^1
  + 注意：SFR可寻址位只能通过特殊功能位定义的方式来使用它，大部分在STC.H头文件中已经定义了，用户不需要再自己定义，但端口寄存器的某一位需要用户自己定义。

#### 端口表示
端口P1的数据寄存器用P1表示，某一位用P1 . 0 表示。
Pn.7 Pn.6 Pn.5 Pn.4 Pn.3 Pn.2 Pn.1 Pn.0
- 端口控制寄存器的相应位设置为1表示输出高电平，设置为0表示输出低电平。
- 输出有锁存，一直保持到被新的值取代为止。

#### 局部变量
优点：
1. 不必考虑本作用域外是否有同名变量
2. 节约RAM空间
3. 便于移植

全局变量越少越好




### 电平特性
数字电路中只有两种电平：高电平和低电平
高电平：5V或者3.3V，取决单片机电源。
低电平：0V
RS232电平：计算机串口的电平
高电平：-12V
低电平：+12V


soala


### 开发流程
5、 如果程序运行后不正常、可以用人工检查、软件仿真器、硬件仿真器、串口助手等技术手段排除所编程序中存在的各种错误。错误排除后，再重复上面的3、4。

### 项目开发相关知识
1. 项目评估
   技术方案，时间，成本
2. 项目实施
2.1 设计电原理图
2.2 事迹印刷电路板（PCB）图
2.3把PCB板发往制版厂做板
2.4 订购开发系统和原件
2.5 PCB板拿到后开始样机装配
2.6样机调试
2.7整理数据，记录元件参数，失败原因，设计失误
2.8制作样机
2.9编写设备文档
2.10修改


### MCS-51单片机基本特性

ROM用来存储我们编写的程序
RAM用来存放程序运算中使用的数据

♦ 8 位的 CPU ， 片内有振荡器和时钟电路, 工作频率为1 ～ 12MHz
（Atmel 89Cxx为0～24MHz）
♦ 片内有 128/256字节 RAM
♦ 片内有 0K/4K/8K字节 程序存储器ROM
♦ 可寻址片外 64K字节 数据存储器RAM
♦ 可寻址片外 64K字节 程序存储器ROM
♦ 片内 21/26个 特殊功能寄存器（SFR）
♦ 4个8位 的并行I/O口（PIO）
♦ 1个 全双工串行口（SIO/UART）
♦ 2/3个16位 定时器/计数器（TIMER/COUNTER）
♦ 可处理 5/6个中断源，两级中断优先级
♦ 内置1个布尔处理器和1个布尔累加器（Cy）
♦ MCS-51指令集含 111条指令（用C语言不需要记指令的）

#### 总线
总线（BUS）是计算机各部件之间传送信息的公共通道。
1、为什么要用总线？
   总线的应用，使得计算机内部的连接变得非常简单。
2、计算机中有内部总线和外部总线两类。
   内部总线是CPU内部之间的连线。
   外部总线是指CPU与其它部件之间的连线。
#### 基本结构
![](https://gitee.com/vonchen/noteimg/raw/master/image/单片机结构.png)
#### 晶振
晶振全称为晶体振荡器，其作用在于产生原始的时钟频率，这个频率晶振经过频率发生器的放大或缩小后就成了电脑中各种不同的总线频率

CPU总是按照一定的时钟节拍与时序工作：
- 振荡周期/时钟周期：Tc=晶振频率fosc（或外加频率）的倒数
- 状态周期：Ts=2个时钟周期(Tc)（很少用到此概念）
- 机器周期：Tm=6个状态周期(Ts)=12个振荡周期(Tc)
- 指令周期: Ti:执行一条指令所需的机器周期(Tm)数

牢牢记住： 振荡周期 = 晶振频率fosc的倒数；
1个机器周期 = 12个振荡周期；
1个指令周期 = 1、2、4个机器周期

#### 单片机的引脚
##### 电源端：Vcc，GND
##### 晶振端：
  XTAL1, XTAL2: 片内振荡电路输入/输出端
![](https://gitee.com/vonchen/noteimg/raw/master/image/晶振引脚.jpg)
##### 复位端：
  + RESET: 复位端（正脉冲有效，宽度>8mS）
  + 复位使单片机进入某种确定的初始状态：
▼ PC值归零（0000H）；
▼ 各个SFR被赋予初始值：
    P0～P3 = 0FFH，Acc = 0，B = 0，TH0=0，
    TL0=0，TH1=0，TL0=0，SP=7，PSW=0 ……
▼退出处于节电工作方式的停顿状态、退出一切程序进程、退出程序的死循环，从头开始。
![](https://gitee.com/vonchen/noteimg/raw/master/image/复位端引脚.png)
##### EA端：
  + ALE/PROG: 地址锁存允许/编程脉冲输入端。
  + P0口寻址外部低8位地址时接外部锁存器 G端；
  + ALE端平时会输出周期正脉冲：f ≈ fosc/6 ；
  + 对片内ROM编程时编程脉冲由此端加入。
##### PSEN端
  PSEN：寻址外部程序存储器时选通外部EPROM的读控制端（OE）低有效。
![](https://gitee.com/vonchen/noteimg/raw/master/image/PESN.png)
##### P1口
  + P1.0—P1.7: 准双向I/O口（内置了上拉电阻）输出时一切照常，仅在作输入口用时要先对其写“1”
  + P1端口用内部上拉电阻代替了场效应管T1，且输出信号仅来自内部总线。
  + 若输出时D端的数据为1，T截止输出为1；
  若D端数据为0，则T导通，引脚输出为低电平；
  + 当P1口作为输入使用时，必须向锁存器写1，使场效应管截止，才可以作为输入使用。
![](https://gitee.com/vonchen/noteimg/raw/master/image/P1引脚.png)
##### IO口
- 单片机和外部设备的交互，无论输入还是输出，都是通过I/O口进行的。
- I/O口在进行数据的输入输出之前，必须先设置==IO模式==。
- 1T单片机所有I/O 口均可通过对PnM1、PnM0这两个控制寄存器配置成4 种工作类型之一， 4 种工作类型分别为：准双向口（标准8 0 5 1 输出模式，输入输出时有弱上拉）、推挽输出（也称强输出）、仅为输入（也是输出高阻）或开漏输出。上电复位后为准双向口（传统8051 的I/O 口）模式。
- 注意：传统8051的I/O 口输出不需要设置，输入时要给写1
123




### 案例
#### 点亮一个LED灯
##### 原理
LED的阳极串联一个电阻，然后连接到电源VCC，
而LED的阴极连接到单片机的P1口，
如果你想点亮一盏LED就对把单片机相对应的IO赋为低电平。
<center><img src="https://gitee.com/vonchen/noteimg/raw/master/image/LED.png"/width=60%></center>

##### 部件
###### 晶振
晶振全称为晶体振荡器，其作用在于产生原始的时钟频率，这个频率晶振经过频率发生器的放大或缩小后就成了电脑中各种不同的总线频率
<img src="https://gitee.com/vonchen/noteimg/raw/master/image/晶振.png"/>
###### 电源
  + 通过变压器和整流器，把交流电变成直流电的装置叫做整流电源。
  + 能提供信号的电子设备叫做信号源。
  + 晶体三极管能把前面送来的信号加以放大，又把放大了的信号传送到后面的电路中去。晶体三极管对后面的电路来说，也可以看做是信号源。
  + 整流电源、信号源有时也叫做电源，电压的单位是V。单片机供电电压一般为5V 3.3V。

###### 字节
1Byte=8bit  - 比特
计算机中的CPU位数指的是CPU一次能处理的最大位数
 
#### 流水灯项目
##### 原理
<center><img src="https://gitee.com/vonchen/noteimg/raw/master/image/LED.png"/width=60%></center>
##### 延时函数
1. 硬件延时--定时器，计数器：CPU效率高，精确延时
2. 软件延时（循环体）
   - 短暂延时
   - 嵌套程序段延时
   - 用示波器确定延时时间
   - 用反汇编工具计算延时时间
##### 初始化
- 函数
  + bst-v51.h
  + bst-v51.c

##### 改变流水灯速度
1. 改变延时函数
2. 更换不同频率的晶振

##### 左移和右移
位运算
- 一般使用8位无符号数，移除的丢弃，空位自动补0
- 不改变参与运算的变量的值
```c
P1<<1;/*左移一位*/
a>>2;/*右移二位*/
```

#### 蜂鸣器使用
字母表示：H，HA
- 压电式蜂鸣器
- 电磁式蜂鸣器

源：震荡源
有源蜂鸣器：电阻几百欧，通电即响
无源蜂鸣器：8，16欧，直流无法驱动

|类型||||
|:---:|:---:|:---:|:---:|
|有源|几百欧|通电即响|贵（震荡电路）程序控制方便|
|无源|8欧，16欧|直流无法驱动，2k-5k方波|便宜，频率可控

工作电流较大，IO口无法直接驱动，要利用放大电路如三极管驱动

##### 设计方法
IO口电平取反方法：I/O 口的电平进行翻转一次，直到蜂鸣器不需要鸣叫的时候，将I/O 口的电平设置为低电平即可。不鸣叫时将I/O 口的输出电平设置为低电平是为了防止漏电

#### 8.数码管静态显示
##### 常用显示器
- 发光二极管LED显示器
- 液晶LCD显示器
- CRT显示器
  
LED和LCD显示器有两种显示结构：
1. 段显示（7段、米字型等）
2. 点阵显示（5×8、8×8点阵等）

特点：
1. 自发光、亮度高，特别适合环境亮度低的场合使用
2. 牢固，不怕冲击
数码管是一种半导体发光器件，其基本单元是发光二极管。

##### 数码管的结构
数码管内部由七个条形发光二极管和一个小圆点发光二极管组成，根据各管的亮暗组合成字符。
常见数码管有10根管脚。管脚排列如下图所示。
其中COM为公共端，根据内部发光二极管的接线形式可分为共阴极和共阳极两种。使用时，共阴极数码管公共端接地，共阳极数码管公共端接电源。
每段发光二极管需5～10mA的驱动电流才能正常发光，一般需加限流电阻控制电流的大小。

##### 数码管显示原理
LED数码管的a～g七个发光二极管。加正电压的发光，加零电压的不能发光，不同亮暗的组合就能形成不同的字型，这种组合称为字型码。
共阳极和共阴极的字型码是不同的

使用LED显示器时，要注意区分这两种不同的接法。为了显示数字或字符，必须对数字或字符进行编码。七段数码管加上一个小数点，共计8段。因此为LED显示器提供的编码正好是一个字节。BST实验板用共阴LED显示器。


![共阳极共阴极](https://raw.githubusercontent.com/FChen-it/image/main/img/20211012152226.png)

共阳数码管：低电平点亮，驱动功率小
共阴数码管：高电平点亮，驱动功率大

每个笔画要串一个数百欧姆的降压电阻

##### 静态显示驱动：直流驱动
每个数码管的，每一个段码都由一个单片机的IO端口进行驱动；
或使用如BCD码二-十进制译码器译码进行驱动
优点：编程简单、亮度高
缺点：占用IO口多，硬件复杂

##### 动态显示驱动

- 将所有数码管的8个显示笔划"a,b,c,d,e,f,g,dp"的同名端连在一起；
- 另外为每个数码管的公共极COM增加位选通控制电路；
- 位选通由各自独立的I/O线控制；
当单片机输出字形码时，所有数码管都接收到相同的字形码，但究竟是那个数码管会显示出字形，取决于单片机对位选通COM端电路的控制；
所以我们只要将需要显示的数码管的选通控制打开，该位就显示出字形，没有选通的数码管就不会亮。通过分时轮流控制各个数码管的的COM端，就使各个数码管轮流受控显示，这就是动态驱动。

在轮流显示过程中，每位数码管的点亮时间为1～2ms，由于人的视觉暂留现象及发光二极管的余辉效应，尽管实际上各位数码管并非同时点亮，但只要扫描的速度足够快，给人的印象就是一组稳定的显示数据，不会有闪烁感，动态显示的效果和静态显示是一样的，能够节省大量的I/O端口，而且功耗更低。
##### 显示效果

电流敏感器件，其正向压降的分散性很大，并且还与温度有关
- 恒定电流，不受其他因素影响
- 温度变化电流自动变化
为了保证数码管具有良好的亮度均匀度，就需要使其具有恒定的工作电流，且不能受温度及其它因素的影响。另外，当温度变化时驱动芯片还要能够自动调节输出电流的大小以实现色差平衡温度补偿

##### 芯片74HC573
八进制 3 态非反转-----透明锁存器
- 当锁存使能端为高时，这些器件的锁存对于数据是透明的（也就是说输出同步）。
- 当锁存使能变低时，符合建立时间和保持时间的数据会被锁存。

功能：数码管、按键的控制

#### 9.数码管动态显示
最常见的多位显示方法

将所有位数码管的段选线并联在一起，由位选线控制是哪一位数码管有效。这样一来，就没有必要每一位数码管配一个锁存器，从而大大地简化了硬件电路。
选亮数码管采用动态扫描显示，即轮流向各位数码管送出字形码和相应的位选
动态显示的亮度比静态显示要差一些，所以在选择限流电阻时应略小于静态显示电路中的。
![动态显示](https://raw.githubusercontent.com/FChen-it/image/main/img/%E5%8A%A8%E6%80%81%E6%98%BE%E7%A4%BA.png)

#### 10.独立键盘输入
##### P3口
P3.0—P3.7: 双功能口（内置了上拉电阻）有特定的第二功能
不适用它的第二功能是他就是普通的筒用准双向IO口
![P3口引脚](https://raw.githubusercontent.com/FChen-it/image/main/img/20211012160436.png)



读端口：读Pn端口寄存器
读引脚：读该引脚在Pn端口寄存器中的对应位

键盘检测：轮询法，中断法
按键时输入信号的抖动现象，==如何进行键盘软件消抖==

- 编码键盘
  计算机键盘
  闭合键识别：专用的硬件编码器，产生键编码号或键值的称为编码键盘
- 非编码键盘
  + 独立键盘
  + 行列式(矩阵式)键盘
  靠软件编程识别
  单片机多用

##### BST-V51独立按键
![BST-V51独立按键](https://raw.githubusercontent.com/FChen-it/image/main/img/20211012161439.png)   
![4×4键盘](https://raw.githubusercontent.com/FChen-it/image/main/img/%E5%9B%BE%E7%89%871.png)

##### 键盘软件消抖
编程方法
通过延时来跳过抖动期
![抖动](https://raw.githubusercontent.com/FChen-it/image/main/img/%E6%8A%96%E5%8A%A8.png)
#### 11.矩阵键盘扫描

优点：键数较多时，可以节约大量的IO口资源







